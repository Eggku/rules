name: è‡ªåŠ¨è½¬æ¢å¹¶å‘å¸ƒ Release
on:
  schedule:
    - cron: "0 0 * * *"  # æ¯ 24 å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆæ¯å¤©åˆå¤œï¼‰
  push:
    branches:
      - main  # ç›‘å¬ `main` åˆ†æ”¯çš„ä»£ç å˜æ›´
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  convert-rules:
    runs-on: windows-latest
    permissions:
      contents: write  # å…è®¸å‘å¸ƒ Release
    steps:
      - name: ğŸ›  æ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v3

      - name: ğŸ”„ ä¸‹è½½ `mihomo.exe`
        run: |
          curl -L -o config/mihomo.exe "https://your-download-link.com/mihomo.exe"
          ls config  # âœ… ç¡®ä¿ `mihomo.exe` ä¸‹è½½æ­£ç¡®
        shell: bash

      - name: ğŸ›  è¿è¡Œ `.bat` è½¬æ¢è„šæœ¬
        run: |
          echo "å¯åŠ¨è½¬æ¢è„šæœ¬..." >> conversion.log
          cmd /c "%GITHUB_WORKSPACE%\config\auto-convert.bat"
        shell: cmd

      - name: âœ… æ£€æŸ¥ `.mrs` æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
        shell: cmd
        run: |
          if exist rules\mrs\*.mrs (
          echo "âœ… .mrs æ–‡ä»¶å·²æˆåŠŸç”Ÿæˆï¼"
          ) else (
          echo "âš ï¸ é”™è¯¯ï¼šæœªæ‰¾åˆ°è½¬æ¢åçš„ .mrs æ–‡ä»¶ï¼"
          exit 1
          )



      - name: ğŸ“¦ æ‰“åŒ…è½¬æ¢åçš„ `.mrs` æ–‡ä»¶
        run: |
          powershell Compress-Archive -Path rules/mrs/* -DestinationPath rules/mrs-release.zip
        shell: powershell

      - name: ğŸš€ ç”Ÿæˆ Release ç‰ˆæœ¬å·
        id: get_date
        run: echo "TAG_NAME=$(date +'%Y%m%d')" >> $GITHUB_ENV
        shell: bash

      - name: ğŸš€ å‘å¸ƒ GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: rules/mrs/*.mrs  # âœ… ç¡®ä¿å‘å¸ƒçš„æ˜¯ `.mrs` æ–‡ä»¶
          tag_name: ${{ env.TAG_NAME }}
          name: "è§„åˆ™æ›´æ–° - ${{ env.TAG_NAME }}"
          body: |
            ğŸš€ **æœ€æ–°è½¬æ¢è§„åˆ™**
            - **æ›´æ–°æ—¶é—´:** ${{ env.TAG_NAME }}
            - **æ–‡ä»¶:** `.mrs` è§„åˆ™é›†
          draft: false
          prerelease: false
